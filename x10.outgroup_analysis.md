Placing Western Australian Acropora digitifera in context
================

To understand the relationship between *A. digitifera* from WA and a
population in Japan we combined our data with publicly available data
from (Shinzato et al. 2015). This combined dataset included all of our
samples as well as 16 samples from the Ryukyu Islands in Japan, randomly
chosen from the Shinzato et al dataset. Note that the Ryukyu Islands is
also the region of origin for the A. digitifera reference genome.
Japanese samples downloaded from NCBI and subjected to the same read
quality checks and alignment process as we applied for our own samples.
The resulting bam files had variable coverage (9x - 32x) roughly in the
same range as those of our Western Australian samples.

### SNP selection and genotype likelihood calculation

As a precursor to running PCAngsd (see below) we first called SNPs,
filtered sites for quality and calculated genotype likelihoods using
angsd (v 0.933) with the
command.

``` bash
angsd -b all_bam.txt -out all -GL 2 -nThreads 8 -doGlf 2 -SNP_pval 1e-6 -doMajorMinor 1 -doMaf 2 -doCounts 1 -minMaf 0.05 -minInd 82 -minMapQ 20 -minQ 20 -setMinDepth 910 -setMaxDepth 3000 -setMinDepthInd 3
```

The options used in this command were chosen to mimic GATK genotype
calling and SNP filtering in our main analysis as closely as possible.
Specifically, `-GL 2` uses a GATK-like genotype likelihood calculation,
`-minInd 82` selects only sites with data for at least 90% of
individuals.

### PCAngsd

We then used PCAngsd version 1.0 obtained from [github commit
cd7feb5a8a76946acde8beaceb919e59dc8d0298](https://github.com/Rosemeis/pcangsd.git)
to perform a PCA analysis. Note that PCAngsd is designed to handle
datasets with differing sequencing depths as is the case
here.

``` bash
pcangsd.py -beagle all.beagle.gz -selection -snp_weights -pcadapt -admix -tree -maf_save -pi_save -dosage_save -sites_save -threads 32 -out jpwa
```

Using the resulting covariance matrix we visualise population structure
using a PCA as follows

![](10.outgroup_analysis_files/figure-gfm/unnamed-chunk-2-1.png)<!-- -->

**Figure 1:** PCA showing population structure for Japanese and Western
Australian A. digitifera samples.

The PCA clearly shows that WA offshore populations are more similar to
each other than to the other samples. The plot also suggests that WA
inshore samples are intermediate between WA offshore and Japanese
samples. With this in mind we construct a neighbour joining tree based
on distances in PCA space using Japan as the root of the tree.

![](10.outgroup_analysis_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

**Figure 2:** Neighbour joining tree based on distances inferred by
PCAngsd and placing Japan at the root.

### Phylogenetic Analysis based on UCE and Exon capture probesets

While the analysis above provides information on relative
differentiation between populations of A. digitifera it is useful to
consider the distances between these populations in the context of
broader phylogenetic differences between species within the Acroporidae.
To do this we make use of methodology developed by (Cowman et al. 2020)
to examine phylogenetic relationships based on UCE and Exon sequences.
Steps in this process include;

1.  [Map](data/hpc/iqtree/02_map_probes.sh) the hexa-v2 probeset to
    genomes of all species (A. digitifera, A. millepora and A. tenuis)
    and filter mapping using samclip.
2.  [Create a bed](data/hpc/iqtree/03_sam2bed.sh) file representing an
    approximately 1000bp region around each mapped probe
3.  [Merge overlapping regions](data/hpc/iqtree/04_extract_bams.sh)
    resulting from closely spaced probes and extract these from bams (in
    the case of A. digitifera)
4.  [Call consensus sequences](data/hpc/iqtree/05_call_consensus.sh)
    from bamfiles
5.  [Extract fasta files](data/hpc/iqtree/06_extract_uces.sh)
    corresponding to merged regions
6.  [Gather and align homologous
    sequences](data/hpc/iqtree/07_gather_uces.sh)
7.  [Create a partition file for phylogenomic
    analysis](data/hpc/iqtree/08_make_partitions.sh)
8.  [Run iqtree to find the best models and generate a
    tree](data/hpc/iqtree/09_iqtree.sh)

The resulting tree (rooted at Acropora tenuis) recovers the expected
relative divergences between species (Aten vs Amil \> Amil vs Adi).
These divergences (Adi vs Amil ~ 25Mya) are clearly much larger than
between population samples of Acropora digitifera, which agrees with our
assessment that these are recently diverged. Notably, samples from
Japan, Inshore and Offshore locations do not follow the population
structure observed in PCA-based methods which may reflect poor
resolution of UCEs at this level.

![](10.outgroup_analysis_files/figure-gfm/unnamed-chunk-4-1.png)<!-- -->

**Figure 3:** Phylogenetic tree based on 1023 UCE and 658 Exon loci from
the Hexa-v2 probeset. Tree is a consensus tree generated by iqtree based
on a partitioned analysis in which each locus was allowed a different
model.

<div id="refs" class="references">

<div id="ref-Cowman2020-mo">

Cowman, Peter F, Andrea M Quattrini, Tom C L Bridge, Gregory J
Watkins-Colwell, Nur Fadli, Mila Grinblat, T Edward Roberts, Catherine S
McFadden, David J Miller, and Andrew H Baird. 2020. “An Enhanced
Target-Enrichment Bait Set for Hexacorallia Provides Phylogenomic
Resolution of the Staghorn Corals (Acroporidae) and Close Relatives.”
*Mol. Phylogenet. Evol.* 153 (December): 106944.

</div>

<div id="ref-Shinzato2015-rz">

Shinzato, Chuya, Sutada Mungpakdee, Nana Arakaki, and Noriyuki Satoh.
2015. “Genome-Wide SNP Analysis Explains Coral Diversity and Recovery in
the Ryukyu Archipelago.” *Sci. Rep.* 5 (December): 18211.

</div>

</div>
